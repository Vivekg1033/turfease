{% extends "base.html" %}

{% block title %}Pending Admin Approvals - TurfEase{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-0">
                    <i class="fas fa-user-check text-primary me-2"></i>Pending Admin Approvals
                </h2>
                <p class="text-muted">Review and approve admin registration requests</p>
            </div>
            <div class="alert alert-warning mb-0" role="alert">
                <i class="fas fa-crown me-2"></i>
                <strong>Main Admin Only:</strong> Only you can approve new administrators
            </div>
        </div>
    </div>
</div>

<!-- Statistics -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-hourglass-half text-warning" style="font-size: 2.5rem;"></i>
                <h3 class="mt-3 mb-1">{{ pending_admins|length }}</h3>
                <p class="text-muted mb-0">Pending Requests</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-user-shield text-success" style="font-size: 2.5rem;"></i>
                <h3 class="mt-3 mb-1">Active</h3>
                <p class="text-muted mb-0">Admin System</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-security text-info" style="font-size: 2.5rem;"></i>
                <h3 class="mt-3 mb-1">Secure</h3>
                <p class="text-muted mb-0">Approval Process</p>
            </div>
        </div>
    </div>
</div>

<!-- Pending Admins List -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list text-primary me-2"></i>
                    Admin Registration Requests
                    {% if pending_admins %}
                        <span class="badge bg-warning ms-2">{{ pending_admins|length }}</span>
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                {% if pending_admins %}
                <div class="row">
                    {% for admin in pending_admins %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning bg-opacity-10">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-user-tie text-warning me-2"></i>Admin Request
                                    </h6>
                                    <span class="badge bg-warning">Pending</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <i class="fas fa-user-circle text-secondary" style="font-size: 3rem;"></i>
                                </div>
                                
                                <div class="mb-3">
                                    <h6 class="card-title">{{ admin.name }}</h6>
                                    <p class="text-muted small mb-1">
                                        <i class="fas fa-envelope me-2"></i>{{ admin.email }}
                                    </p>
                                    <p class="text-muted small mb-1">
                                        <i class="fas fa-users me-2"></i>{{ admin.division }}
                                    </p>
                                    <p class="text-muted small">
                                        <i class="fas fa-calendar me-2"></i>Applied: {{ admin.created_at }}
                                    </p>
                                </div>
                                
                                <div class="border-top pt-3">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" 
                                                onclick="approveAdmin({{ admin.id }}, '{{ admin.name }}')">
                                            <i class="fas fa-check me-2"></i>Approve Admin
                                        </button>
                                        <button class="btn btn-outline-danger" 
                                                onclick="rejectAdmin({{ admin.id }}, '{{ admin.name }}')">
                                            <i class="fas fa-times me-2"></i>Reject Request
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Bulk Actions -->
                {% if pending_admins|length > 1 %}
                <div class="border-top pt-4 mt-4">
                    <h6 class="text-muted mb-3">
                        <i class="fas fa-tasks me-2"></i>Bulk Actions
                    </h6>
                    <div class="d-flex gap-2">
                        <button class="btn btn-success" onclick="approveAllAdmins()">
                            <i class="fas fa-check-double me-2"></i>Approve All ({{ pending_admins|length }})
                        </button>
                        <button class="btn btn-outline-danger" onclick="rejectAllAdmins()">
                            <i class="fas fa-times-circle me-2"></i>Reject All
                        </button>
                    </div>
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-success">All Set!</h4>
                    <p class="text-muted">No pending admin requests at the moment.</p>
                    <p class="text-muted small">
                        New admin registration requests will appear here for your approval.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Admin Guidelines -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>Admin Approval Guidelines
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-success">
                            <i class="fas fa-check me-2"></i>Approve If:
                        </h6>
                        <ul class="small text-muted">
                            <li>Applicant is a trusted faculty member</li>
                            <li>Part of the official Sports Council</li>
                            <li>Has legitimate administrative needs</li>
                            <li>Email domain is verified (@ves.ac.in)</li>
                        </ul>
                        
                        <h6 class="text-warning mt-3">
                            <i class="fas fa-exclamation-triangle me-2"></i>Admin Privileges:
                        </h6>
                        <ul class="small text-muted">
                            <li>Approve/decline all turf bookings</li>
                            <li>Post notices and announcements</li>
                            <li>Manage turf availability schedules</li>
                            <li>Access to all booking data</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-danger">
                            <i class="fas fa-times me-2"></i>Reject If:
                        </h6>
                        <ul class="small text-muted">
                            <li>Unknown or suspicious applicant</li>
                            <li>Student attempting to gain admin access</li>
                            <li>Duplicate or fake registration</li>
                            <li>Invalid email or contact information</li>
                        </ul>
                        
                        <h6 class="text-info mt-3">
                            <i class="fas fa-shield-alt me-2"></i>Security Notes:
                        </h6>
                        <ul class="small text-muted">
                            <li>Only you (main admin) can approve admins</li>
                            <li>All admin actions are logged</li>
                            <li>You can revoke admin access anytime</li>
                            <li>Regular security audits recommended</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function approveAdmin(adminId, adminName) {
    if (confirm(`Are you sure you want to approve ${adminName} as an administrator?\n\nThis will grant them full admin privileges including:\n- Booking management\n- Notice posting\n- System configuration`)) {
        showLoadingState(`Approving ${adminName}...`);
        window.location.href = `/admin/approve_admin/${adminId}`;
    }
}

function rejectAdmin(adminId, adminName) {
    const reason = prompt(`Please provide a reason for rejecting ${adminName}'s admin request:`);
    if (reason && reason.trim()) {
        if (confirm(`Reject ${adminName}'s admin request?\n\nReason: ${reason}`)) {
            showLoadingState(`Rejecting ${adminName}...`);
            window.location.href = `/admin/reject_admin/${adminId}?reason=${encodeURIComponent(reason)}`;
        }
    } else if (reason !== null) {
        alert('Please provide a reason for rejection.');
    }
}

function approveAllAdmins() {
    const count = {{ pending_admins|length }};
    if (confirm(`Are you sure you want to approve ALL ${count} pending admin requests?\n\nThis will grant admin privileges to all pending applicants.`)) {
        showLoadingState(`Approving all ${count} admins...`);
        
        // You would implement bulk approval here
        // For demonstration, we'll just show a message
        setTimeout(() => {
            alert(`All ${count} admin requests have been approved.`);
            location.reload();
        }, 2000);
    }
}

function rejectAllAdmins() {
    const count = {{ pending_admins|length }};
    const reason = prompt(`Please provide a reason for rejecting all ${count} admin requests:`);
    
    if (reason && reason.trim()) {
        if (confirm(`Reject ALL ${count} pending admin requests?\n\nReason: ${reason}`)) {
            showLoadingState(`Rejecting all ${count} requests...`);
            
            // You would implement bulk rejection here
            setTimeout(() => {
                alert(`All ${count} admin requests have been rejected.`);
                location.reload();
            }, 2000);
        }
    } else if (reason !== null) {
        alert('Please provide a reason for bulk rejection.');
    }
}

function showLoadingState(message) {
    // Create and show a loading overlay
    const overlay = document.createElement('div');
    overlay.className = 'position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center';
    overlay.style.backgroundColor = 'rgba(0,0,0,0.7)';
    overlay.style.zIndex = '9999';
    overlay.innerHTML = `
        <div class="card text-center">
            <div class="card-body">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5 class="text-white">${message}</h5>
            </div>
        </div>
    `;
    document.body.appendChild(overlay);
}

// Auto-refresh every 60 seconds to check for new admin requests
setInterval(function() {
    // Only refresh if no actions are in progress
    if (!document.querySelector('.position-fixed')) {
        location.reload();
    }
}, 60000);

// Notification sound for new requests (optional)
document.addEventListener('DOMContentLoaded', function() {
    const pendingCount = {{ pending_admins|length }};
    if (pendingCount > 0) {
        // You could play a subtle notification sound here
        console.log(`${pendingCount} admin requests pending approval`);
    }
});
</script>
{% endblock %}